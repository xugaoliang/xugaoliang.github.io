[TOC]

## 鞅的起源

鞅（martingale)的概念最早起源于赌博中的双倍押注法（double gambling)，在该策略下，如果每次输了就把下注的资金翻倍。对于公平赌博而言，如此反复最终总能赢钱。

在马术上，鞅指的是套在马颈上的缰绳（马颔缰），以防止马甩头，并借此控制马的行进方向

## 条件期望

注意区别于**条件概率**，他们是两码事

定义：假设有两个随机变量$X$和$Y$，并且他们的取值取决于$N$次发生的时间构成的信息集$\{Z_1,Z_2,\dots,Z_N\}$。以其中$n$次事件的信息集为条件，得到的随机变量期望就是条件期望（conditional expectation）。记作：

$E_n(X) = E(X|Z_1,Z_2,\dots,Z_n),E_n(Y)=E(Y|Z_1,Z_2,\dots,Z_n)$

### 可测

随机变量$E_n(X)$的值，仅与$Z_1,Z_2,\dots,Z_n$有关时，我们可以将其写作：$E_n(X)=E(X|Z_1,Z_2,\dots,Z_n)=f(Z_1,Z_2,\dots,Z_n)$

其中$f(·)$是函数。显然此处随机变量$E_n(X)$可以表示为$Z_1,Z_2,\cdots,Z_n$的函数，我们称$E_n(X)$关于$Z_1,Z_2,\cdots,Z_n$可测(measurable)

我的直观理解：可用函数测度的意思，也意味着可以直接通过自变量计算出具体数值的意思

### 条件期望的性质

* 线性性质：对于所有的常数$c_1$和$c_2$，以下等式成立：$E_n(c_1 X+c_2 Y)=c_1 E_n(X)+c_2 E_n(Y)$

* 提取已知量（taking out what is known)：若$X$的取值只依赖于$n$次事件的信息集，则：$E_n(XY)=X·E_n(Y)$。
  * 在这里，$X$在$n$次事件的信息集下是可测的，从而可以从条件期望中提取出来
* 累次条件期望(iterated conditioning):若$0\le n \le m \le N$，则有$E_n(E_m(x))=E_n(X)$
  * 从中可以看出，$X$的条件期望，**取决于信息集中最小者**。
  * 特别是针对无条件期望而言，有：$E[E_m(X)]=E(X)$
  * 因为无条件的信息量最小
* 独立性（independence）：若X取决于第$n+1$到$N$次事件所构成的信息集$\{Z_{n+1},Z_{n+2},\cdots,Z_N\}$，则有：$E_n(X)=E(X)$
  * 因为此处的条件与随机变量$X$无关

* Jensen 不等式：如果$\phi(·)$是凸函数（下凸），则下列不等式成立：$E_n(\phi(X))\ge \phi(E_n(X))$

## 离散鞅

定义：假设有一个随机序列$\{X_n\},n=0,1,2,\cdots,$若对$\forall n \ge 0$,均有$E|X_n|<\infty$（这是保证$X_n$的期望有界，这里是$X_n$的绝对值）,并且$E(X_{n+1}|X_n,\cdots,X_2,X_1)=X_n$。则称$\{X_n\}$为离散鞅（discrete martingale）序列。

注意：离散鞅具有某种无后效性（即只与当前有关，与更早的没关），并且随机变量$X_{n+1}$对之前所有信息下的条件期望，只取决于$n$时刻的$X_n$，而与$n$时刻之前的随机变量序列$X_0,X_1,\cdots,X_{n-1}$无关，并且该条件期望刚好等于$n$时刻的随机变量$X_n$

### 对比马氏过程

* 离散鞅的表达式：$E(X_{n+1}|X_n,\cdots,X_2,X_1)=X_n$
* 马氏过程表达式：$P(X_{n+1}|X_n,\cdots,X_2,X_1)=P(X_{n+1}|X_n)$
* 鞅是通过条件期望定义的，侧重于未来结果的**公平性**；马氏过程则是通过条件概率定义的，侧重于过程的**无记忆性**，因此两者之间并无太多的相关性

注意：对于布朗运动而言，其既有马氏过程也是鞅

对称随机游走的总距离是鞅：$P(X_i=+1)=P(X_i=-1)=0.5$，截止$n$时刻，粒子游走的总距离$S_n = X_1+X_2+\cdots+X_n$，并且$S_0 = 0$，可证$S_n$是鞅

* 即证$E(S_{n+1}|S_n) = S_n$（？？？左式不是应该为$E(S_{n+1}|S_n,\cdots,S_1)$才行吗？他们等价吗？）
* $E(S_{n+1}|S_n) = E(S_n+X_{n+1}|S_n)=E[S_n|S_n]+E[X_{n+1}|S_n]=S_n+0.5*1+0.5*-1=S_n$
* $E[S_n|S_n]$是确定性事件，结果就是$S_n$

### 鞅的推广

定义：设$\{X_n\}$和$\{Y_n\}$是两个随机序列，其中$n=0,1,2,\cdots$。若对任意$n$，有：

* $E|X_n|< \infty$
* $X_n$是关于$Y_0,Y_1,\cdots,Y_n$的函数（即$X_n$是关于$Y_0,Y_1,\cdots,Y_n$可测）
* $E(X_{n+1}|Y_n,\cdots,Y_1,Y_0)=X_n$

则称$\{X_n\}$是关于$\{Y_n\}$的鞅。

### 定理

$\{X_n\}$是关于$\{Y_t\}$的鞅的充要条件为：$\forall m,n(m>n>0)$，有：$E[X_m|Y_0,Y_1,\cdots,Y_n]=X_n$

### 证明波利亚坛子问题是鞅（略）

### 推论

* 对于常数序列$\{c_n\}$,其中$c_n=c$，则$\{c_n\}$为鞅
* 若$\{X_n\}$是鞅，则对任意$n\ge 0$，有$EX_n=EX_0$
  * $E[X_{n+1}|Y_0,Y_1,\cdots,Y_n]=X_n$
  * 两端取期望（无条件的期望，根据条件期望的独立性，其结果等于无条件期望）
  * $E\{E[X_{n+1}|Y_0,Y_1,\cdots,Y_n]\}=EX_n$
  * $E[X_{n+1}]=E(X_n)$
  * 同理：$E[X_{n+1}]=E[X_n]=\cdots=E[X_1]=E[X_0]$

## 连续鞅

### 可积（integrable）

定义：对于一个随机变量$X$

* 若$E|X|<\infty$,则称$X$是可积的（integrable）
* 若$E(X^2)<\infty$，则称$X$是平方可积的（square integrable）

根据可积的定义可知：$E(X)\le E|X|<\infty$。

因此，当随机变量$X$可积时，其**期望值必然是有限的**，类似的，当$X$是平方可积时，**其方差必然是有限的**。

$Var(X)=E(X^2)-(E(X))^2<\infty$

### 域流（filtration）

可以看做是信息流

定义：假设$T$是一个固定的正数，并且对每一个$t\in[0,T]$,都有一个$\sigma$代数$\mathcal{F}(t)$与之对应。若对任意$0\le s\le t\le T$，均有$\mathcal{F}(s)\subseteq \mathcal{F}(t)$成立，则称$\{\mathcal{F}(t) \},t\in [0,T]$所构成的$\sigma$代数族是一个域流（filtration）

$\mathcal{F}(t)$可看作$[0,t]$时间段的所有信息（information）。随着时间的推移，信息逐渐增加，体现为新时刻包含了旧时刻的所有信息。由这些信息所组成的序列$\{\mathcal{F}(0),\mathcal{F}(1),\cdots,\mathcal{F}(t)\}$构成了域流，相当于一串信息流，并且$\mathcal{F}(0) \subseteq \mathcal{F}(1)\subseteq \cdots \subseteq \mathcal{F}(t) $

用域流替代离散鞅中的信息集$\{Z_1,Z_2,\dots,Z_N\}$

### 基于条件期望的结论

* 对于可积随机变量$X$和$Y$,有：$E[c_1 X + c_2 Y | \mathcal{F}]=c_1 E[X|\mathcal{F}] + c_2 E[Y|\mathcal{F}]$,其中$c_1,c_2$是常数
* 若$X$和$Y$是可积随机变量，$XY$可积，并且$X$为$\mathcal{F}$可测，则有：
  * $E[XY|\mathcal{F}]=XE[Y|\mathcal{F}]$
  * $E[X|\mathcal{F}]=X$
  * 由于$X$为$\mathcal{F}$可测，因此$\mathcal{F}$中所包含的信息足以确定$X$的值
* 若可积随机变量$X$与$\mathcal{F}$独立，则：$E[X|\mathcal{F}]=E[X]$，由于$X$与$\mathcal{F}$独立，因此$\mathcal{F}$中所包含的信息无法确定$X$的值
* 若$\mathcal{F} \subseteq \mathcal{G}$,则对于可积随机变量$X$,下式成立：$E[E[X|\mathcal{G}]|\mathcal{F}]=E[X|\mathcal{F}]$。这里由于$\mathcal{F}\subseteq \mathcal{G}$，因此$\mathcal{F}$中所包含的信息要小于$\mathcal{G}$,于是最终的条件期望取决于信息量较少的$\mathcal{F}$。
* 若$\phi(x)$是关于$x$的凸函数，且$X$是可积随机变量，则有：$E[\phi(X)|\mathcal{F}]\ge \phi(E[X|\mathcal{F}])$

### 连续鞅定义

若概率空间$\{\Omega,\mathcal{F},P\}$上的随机过程$M_t$满足以下三个条件，则称其为关于域流$\{\mathcal{F}(t)\}$和概率测度$P$的连续鞅

* 对任意$t$，有$E|M_t|<\infty$,即$M_t$是可积的
* $M_t$对任意$t$均是$\mathcal{F}(t)$可测的（measurable）
* 若$s<t$,则$E[M_t|\mathcal{F}(s)]=M_s, a.s.$说明：a.s.（almost surely，几乎一定，基本确定，即结论不成立的概率为0） 
  * 等价公式
  * $E[M_t-M_s|\mathcal{F}(s)]=0$
  * $E[\frac{M_t}{M_s}|\mathcal{F}(s)]=1$



说明：$\Omega$是状态空间，$\mathcal{F}$是$\sigma$代数即信息，$P$是概率，$\{\Omega,\mathcal{F},P\}$是概率空间

我们是在用s时刻所知道的信息，来认识未来时刻t的信息

### 泊松过程与鞅 

 假设泊松过程$\{N(t),t\ge 0\}$的强度为$\lambda$，可证$N(t)-\lambda t$是一个鞅

证：$E[M_t-M_s|\mathcal{F}(s)] = E[N(t)-\lambda t - (N(s)-\lambda s)|\mathcal{F}(s)] \\ = E[N(t)-N(s)+\lambda(s-t)|\mathcal{F}(s)] \\ =E[N(t)-N(s)|\mathcal{F}(s)] + \lambda (s-t)$

泊松过程增量独立性：$E[N(t)-N(s)|\mathcal{F}(s)] = E[N(t)-N(s)] = E[N(t)]-E[N(s)] = \lambda t-\lambda s$

所以：$E[M_t-M_s | \mathcal{F}(s)] = 0 $，得证

### 上鞅和下鞅

对于随机过程$M_t$，若$s<t$并且满足：

* $E[M_t|\mathcal{F}(s)] \ge M_s$，则称$M_t$是下鞅(submartingale)
* $E[M_t|\mathcal{F}(s)] \le M_s$，则称$M_t$是上鞅(supermartingale)

对于下鞅而言：$E[M_t] \ge E[M_s], s<t$（两边取无条件期望可得）。不难看出，随着时间的流逝，$M_t$的期望值趋向于增大；相反对于上鞅，$M_t$的期望值趋向于减小。

含义：

**对于公平赌博而言，赌徒赢钱的期望值不随时间而发生改变，因此是鞅**

**相比之下，上鞅则意味着赌徒赢钱的期望值随时间而减小，因此是亏本的赌博（劣赌）；下鞅意味着赌徒赢钱的期望值随时间而增大，因此是盈利的赌博（优赌）。**

### 布朗运动是鞅

$E[W(t)|\mathcal{F}(s)] = E[W(t)-W(s)+W(s)|\mathcal{F}(s)] \\ =E[W(t)-W(s)|\mathcal{F}(s)] + E[W(s)|\mathcal{F}(s)] \\ =E[W(t)-W(s)] + W(s) = W(s)$

其中:$W(t)-W(s)$与$\mathcal{F}(s)$独立，并且$W(s)$是$\mathcal{F}(s)$可测

因此：布朗运动$W(t)$是关于$\mathcal{F}(s)$的鞅

布朗运动是鞅，鞅是无套利空间的

## 鞅的金融学意义

$E[X(t+u)-X(t)|\mathcal{F}(t)] = E[X(t+u)|\mathcal{F}(t)] - E[X(t)|\mathcal{F}(s)]=X(t)-X(t)=0$

由于鞅在未来的移动方向是不可能被预测的，因此，如果我们观察到一个随机过程的轨迹有明显的趋势性倾向或周期性规律，那么，该随机过程一定不是鞅。

有效市场假说的概念与鞅的含义不谋而合

在金融工程中，我们往往基于无套利分析法对金融产品进行定价。在有效市场中套利机会是不存在的，正因如此，鞅可以被看做无套利的数学描述（可证明）

对常见金融资产价格进行分析，发现他们并非都满足鞅的特性。比如欧式期权，时间价值会因为合约到期日的邻近而趋于减少，因此欧式期权的价值满足上鞅。